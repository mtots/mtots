import sys
import gg
from media import Image
from random import Random

final rand = Random()
final window = gg.Window(
  "Fake3D", 400, 400,
  gg.Window.defaultFPS(),
  gg.Window.flagRESIZABLE()
  # gg.Window.flagFIXEDFULLSCREEN()
  # gg.Window.flagFULLSCREEN()
)
print(window.transform)
window.transform.translate(V(window.width / 2, window.height / 2))
print(window.transform)
print("Manual")
print("(upper-left)  -> %s" % [window.transform.apply(V(-window.width/2, -window.height/2))])
print("(upper-right) -> %s" % [window.transform.apply(V(window.width/2, -window.height/2))])
print("(lower-right) -> %s" % [window.transform.apply(V(window.width/2, window.height/2))])
print("(lower-left)  -> %s" % [window.transform.apply(V(-window.width/2, window.height/2))])
window.setCamera(V(-window.width/2, -window.height/2), V(window.width/2, window.height/2))
print("setCamera")
print("(upper-left)  -> %s" % [window.transform.apply(V(-window.width/2, -window.height/2))])
print("(upper-right) -> %s" % [window.transform.apply(V(window.width/2, -window.height/2))])
print("(lower-right) -> %s" % [window.transform.apply(V(window.width/2, window.height/2))])
print("(lower-left)  -> %s" % [window.transform.apply(V(-window.width/2, window.height/2))])
print(window.transform)

print("window dim = %s, %s" % [window.width, window.height])

final ballImage = Image(100, 100)
for i in range(ballImage.width):
  for j in range(ballImage.height):
    if ((i - ballImage.width // 2) ** 2) + ((j - ballImage.height // 2) ** 2) < 30 ** 2:
      ballImage.set(i, j, Color(255, 255, 255))
final ballGeometry = window.newPolygon(
  [V(-1, -1), V(1, -1), V(1, 1), V(-1, 1)],
  nil,
  window.newTexture(ballImage))

var angleY = 0
var angleZ = 0
var zoomExp = 0
var viewX = 0
var viewY = 0

@window.onUpdate
def():

  if gg.key(gg.SCANCODE.F):
    zoomExp = zoomExp + 0.05
  if gg.key(gg.SCANCODE.G):
    zoomExp = zoomExp - 0.05
  if gg.key(gg.SCANCODE.LEFT):
    viewX = viewX - 15
  if gg.key(gg.SCANCODE.RIGHT):
    viewX = viewX + 15
  if gg.key(gg.SCANCODE.UP):
    viewY = viewY - 15
  if gg.key(gg.SCANCODE.DOWN):
    viewY = viewY + 15

  final zoom = 1.5 ** zoomExp
  window.setCamera(
    V(viewX + zoom * -window.width/2, viewY + zoom * -window.height/2),
    V(viewX + zoom * window.width/2, viewY + zoom * window.height/2))
  ballGeometry.setVertexColor(0, gg.RED)
  ballGeometry.setVertexColor(1, gg.GREEN)
  ballGeometry.setVertexColor(2, gg.BLUE)
  ballGeometry.setVertexColor(3, gg.LIGHT_YELLOW)
  ballGeometry.transform.reset()
  ballGeometry.transform.scaleX(100)
  ballGeometry.transform.scaleY(100)
  ballGeometry.transform.rotateY(angleY)
  ballGeometry.transform.rotateZ(angleZ)
  ballGeometry.blit()
  angleZ = angleZ + 0.014
  angleY = angleY + 0.06
