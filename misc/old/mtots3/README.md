This time allowing myself to use modern C++, but fit everything in a single file
